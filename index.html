<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QuickSum - Your Friendly Text Buddy</title>
    <meta name="description" content="A smart and lovable assistant that helps users make sense of long content in seconds." />
    <meta name="author" content="QuickSum" />

    <meta property="og:title" content="QuickSum - Your Friendly Text Buddy" />
    <meta property="og:description" content="A smart and lovable assistant that helps users make sense of long content in seconds." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>
  <body>
    <div id="root"></div>
    <!-- Start: Enhanced Summarizer UI -->
    <div style="max-width:600px;margin:40px auto;padding:20px;border:1px solid #eee;border-radius:8px;background:#fafcff;">
      <textarea id="inputText" placeholder="Enter text here..." rows="8" cols="60" style="width:100%;padding:10px;border-radius:4px;border:1px solid #ccc;display:block;"></textarea>
      <div style="margin:12px 0;">
        <input type="file" id="pdfInput" accept="application/pdf" style="margin-top:8px;" />
        <span style="font-size:13px;color:#888;margin-left:10px;">Optional: Upload PDF</span>
      </div>
      <button onclick="summarizeText()" style="padding:8px 20px;border-radius:4px;background:#3587fe;color:white;font-weight:bold;border:none;cursor:pointer;">Summarize</button>
      <p style="margin-top:16px;"><strong>Summary:</strong></p>
      <div id="output" style="min-height:40px;border:1px solid #eef;padding:10px;border-radius:4px;background:#f6faff;"></div>
    </div>
    <!-- End: Enhanced Summarizer UI -->

    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>

    <!-- Inline JS for Enhanced Summarizer Button -->
    <script>
      async function extractTextFromPDF(file) {
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = function(event) {
            try {
              // Basic ASCII extraction (very simplified!)
              const uint8 = new Uint8Array(event.target.result);
              let text = '';
              for (let i = 0; i < uint8.length; i++) {
                if (uint8[i] >= 32 && uint8[i] <= 126) {
                  text += String.fromCharCode(uint8[i]);
                }
              }
              text = text.replace(/[^\w\s.,?!;:'"()-]/g, ' ').replace(/\s+/g, ' ').trim();
              // If text is short, provide fallback
              if (text.length < 80) {
                resolve('This PDF could not be fully read in your browser. Please copy & paste text instead.');
              } else {
                resolve(text);
              }
            } catch {
              resolve('Error reading PDF content. Please try another file or paste your text.');
            }
          };
          reader.onerror = function() {
            resolve('Error reading PDF file.');
          };
          reader.readAsArrayBuffer(file);
        });
      }

      async function summarizeText() {
        const textAreaValue = document.getElementById("inputText").value;
        const pdfInput = document.getElementById("pdfInput");
        const pdfFile = pdfInput && pdfInput.files && pdfInput.files[0];
        document.getElementById("output").innerText = "Summarizing...";

        let contentToSummarize = textAreaValue;
        if (pdfFile) {
          contentToSummarize = await extractTextFromPDF(pdfFile);
        }
        if (!contentToSummarize || contentToSummarize.trim().length < 5) {
          document.getElementById("output").innerText = "Please provide text or a readable PDF file.";
          return;
        }

        try {
          const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyDdbLRPhyqzxsMz4TOlqC3THnW-pjbcy5Q", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              contents: [
                {
                  parts: [
                    { text: "Summarize this text:\n" + contentToSummarize }
                  ]
                }
              ]
            })
          });

          const data = await response.json();
          const summary = data?.candidates?.[0]?.content?.parts?.[0]?.text || "No summary found.";
          document.getElementById("output").innerText = summary;
        } catch (err) {
          document.getElementById("output").innerText = "Error summarizing. Please try again later.";
        }
      }
    </script>
  </body>
</html>
